# HyperBEAM

## Install WAO & HyperBEAM

```bash
yarn add wao
```
In addition to the WAO SDK, you will need to [install HyperBEAM](https://permaweb.github.io/HyperBEAM/getting-started/requirements/) on your local computer (recommended) or a cloud server. The required systems are not the only ones you can install HyperBEAM on. I was, for example, able to install HyperBEAM on [Arch Linux](https://archlinux.org/) by installing the necessary dependencies. You could throw installation errors at LLMs like OpenaI and Claude and likely be able to figure it out.

If you want to test Mainnet AOS modules, you need to install the WAO fork of HyperBEAM, which includes a custom helper device for testing.

```bash
git clone --branch wao https://github.com/weavedb/HyperBEAM.git
```

Make sure you compiled it and are able to run `rebar3 shell`, but you don't need to have it running yet. You might need to add environment variables depending on how you installed it on your system. WAO SDK handles that too.

```bash
CMAKE_POLICY_VERSION_MINIMUM=3.5 CC=gcc-12 CXX=g++-12 rebar3 shell
```

## Create a Project

To create a project, you could use `npx wao create APP_NAME`,

```bash
npx wao create myapp && cd myapp
```

or you could manually install `wao` into your project.

```bash
mkdir myapp && cd myapp && yarn init && yarn add wao
mkdir test && touch test/test.js
```

Make sure your `package.json` looks something like the following to enable ES6 and test commands with `wasm64`. The wasm64 flag is unnecessary for NodeJS v24 and later.

```json
{
  "name": "myapp",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "test": "node --experimental-wasm-memory64",
    "test-only": "node --experimental-wasm-memory64 --test-only"
  },
  "dependencies": {
    "wao": "^0.22.1"
  }
}
```
## Write Tests

`HyperBEAM` class let you create a HyperBEAM sandbox by starting a fresh HyperBEAM node before testing and shutting it down when tests are complete.
You can interact with the HyperBEAM node with `HB`.

The WAO server needs to be running if you plan to use `process@1.0` device.

You can also skip the `HyperBEAM` class and connect with an already running remote node by specifying the node `url` to `HB`.

```js
import assert from "assert"
import { describe, it, before, after, beforeEach } from "node:test"
import { wait, toAddr, Server } from "wao/test"
import { HyperBEAM, HB } from "wao"
import { resolve } from "path"
import { readFileSync } from "fs"

const cwd = "../../HyperBEAM" // HyperBEAM directory
const wallet = ".wallet.json" // operator wallet relative to cwd
const port = 10001
const gateway = 4000
const url = `http://localhost:${port}`

describe("HyperBEAM", function () {
  let hbeam, hb, jwk, server
  before(async () => {
    server = new Server({ port: 4000, log: true, hb_url: url })
    hbeam = new HyperBEAM({ cwd, wallet, port })
    jwk = JSON.parse(
      readFileSync(resolve(import.meta.dirname, cwd, wallet), "utf8")
    )
    await wait(5000)
  })
  beforeEach(async () => {
    hb = await new HB({ url }).init(jwk)
  })
  after(async () => hbeam.kill())

  it("should run a HyperBEAM node", async () => {
    const info = await hb.meta.info()
    assert.equal(info.address, toAddr(jwk.n))
  })
})
```

HyperBEAM has [a test device](https://github.com/permaweb/HyperBEAM/blob/main/src/dev_test.erl) to test basic features with the HB methods.
- `spawn` : spawn a process
- `schedule` : schedule a message to a process
- `compute` : compute the result of a slot
- `messages` : list messages in a process

```js
it("should test test-device@1.0", async () => {
  const { pid } = await hb.spawn({ "execution-device": "test-device@1.0" })
  const { slot } = await hb.schedule({ pid })
  const res = await hb.compute({ pid, slot })
  assert.equal(res.results["assignment-slot"], 1)
  const {
      edges: [ edge0, { node: { assignment, message } }]
  } = await hb.messages({ pid, from: 0, to: 1 })
  assert.equal(message.Target, pid)
})
```